@model GameTracker.ViewModel.Games.GamePageViewModel
@{
    ViewData["Title"] = Model.GameViewModel.Name;
}

<div class="game-page">
    <!-- Игра: изображение и основная информация -->
    <div class="game-header text-center mb-4">
        <img class="game-image img-fluid" src="@Model.GameViewModel.ImageUrl" alt="@Model.GameViewModel.Name" />
        <h2>@Model.GameViewModel.Name</h2>
        <p><strong>Жанр:</strong> @Model.GameViewModel.Genre.ToString()</p>
        <p><strong>Дата выпуска:</strong> @Model.GameViewModel.ReleaseDate.ToString("dd.MM.yyyy")</p>
        <p><strong>Описание:</strong> @Model.GameViewModel.Description</p>
        <p><strong>Разработчик:</strong> @Model.GameViewModel.DeveloperName</p>
        <p><strong>Издатель:</strong> @Model.GameViewModel.PublisherName</p>
    </div>

    <!-- Статус и оценка игры -->
    @if (Model.GameViewModel.Status == GameTracker.Entity.Games.GameStatus.Nothing)
    {
        <div class="alert alert-info">
            <p>Игры нет в вашей библиотеке.</p>
            <form asp-action="AddGameToLibrary"
                  asp-controller="UserLibrary"
                  asp-route-gameId="@Model.GameViewModel.Id"
                  method="post">
                <button type="submit" class="btn btn-primary">Добавить игру в библиотеку</button>
            </form>
        </div>
    }
    else
    {
        <div class="border-top mt-4 pt-3">
            <p><strong>Статус:</strong> @Model.GameViewModel.Status</p>
            @if (Model.GameViewModel.Rating == 0)
            {
                <p><strong>Оценка:</strong> Нет оценки</p>
            }
            else
            {
                <p><strong>Оценка:</strong>@Model.GameViewModel.Rating</p>
            }
            <button class="btn btn-warning" onclick="openEditModal()">Изменить статус и оценку</button>
        </div>

        <!-- Модальное окно для редактирования статуса и оценки -->
        <div id="editModal" class="modal" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Изменить статус и оценку</h5>
                        <button type="button" class="close" onclick="closeEditModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        @await Html.PartialAsync("~/Views/Shared/_ChangeStatusAndRatingPartial.cshtml", Model.GameRateAndStatusViewModel, new ViewDataDictionary(ViewData) { ["GameId"] = Model.GameViewModel.Id })
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Удаление игры из библиотеки -->
        <div class="mt-4">
            <form asp-action="RemoveFromLibrary" asp-controller="UserLibrary" asp-route-gameId="@Model.GameViewModel.Id">
                <button type="submit" class="btn btn-danger">Удалить игру из библиотеки</button>
            </form>
        </div>
    }

    <!-- Возможность для модераторов/администраторов удалить или редактировать игру -->
    @if (User.IsInRole("Moderator") || User.IsInRole("Admin"))
    {
        <div class="mt-4">
            <form asp-action="RemoveGame"
                  asp-controller="Catalog"
                  method="post">
                <input type="hidden" name="gameId" value="@Model.GameViewModel.Id" />
                <button type="submit" class="btn btn-danger">Удалить игру с сайта</button>
            </form>

            <form asp-action="EditGame"
                  asp-controller="Game"
                  method="get">
                <input type="hidden" name="gameId" value="@Model.GameViewModel.Id" />
                <button type="submit" class="btn btn-primary mt-4">Редактировать игру</button>
            </form>
        </div>
    }
</div>

<script>
    function openEditModal(){
        document.getElementById("editModal").style.display = "block";
    }

    function closeEditModal(){
        document.getElementById("editModal").style.display = "none";
    }
</script>
